CREATE DATABASE QLDANV

CREATE TABLE NHANVIEN
(
	MANV CHAR(6) NOT NULL,
	HOTENNV VARCHAR(50),
	NGAYVAOLAM DATETIME, 
	LUONGCB MONEY, 
	MAQL CHAR(6),
	CONSTRAINT PK_NV PRIMARY KEY(MANV)
);

alter TABLE NHANVIEN
ALTER COLUMN NGAYVAOLAM DATETIME

CREATE TABLE PHONGBAN
(
	MAPHONGBAN CHAR(6) NOT NULL,
	TENPHPNGBAN VARCHAR(30),
	MAQL CHAR(6),
	CONSTRAINT PK_PB PRIMARY KEY(MAPHONGBAN),
	CONSTRAINT FK_MAQL FOREIGN KEY(MAQL) REFERENCES NHANVIEN(MANV)
);

CREATE TABLE DUAN 
(
	MADUAN CHAR(6), 
	TENDUAN VARCHAR(40),
	CONSTRAINT PK_DUAN PRIMARY KEY(MADUAN)
);

CREATE TABLE THAMGIADUAN
(
	MADUAN CHAR(6),
	MANV CHAR(6),
	LUONGDA MONEY,
	PHANTRAMTG DECIMAL(5,2),
	TGBD DATETIME,
	TGKT DATETIME,
	CONSTRAINT PK_TGDA PRIMARY KEY(MADUAN, MANV),
	CONSTRAINT FK_MADUAN FOREIGN KEY(MADUAN) REFERENCES DUAN(MADUAN),
	CONSTRAINT FK_MANV FOREIGN KEY(MANV) REFERENCES NHANVIEN(MANV)
);

alter TABLE THAMGIADUAN
ALTER COLUMN TGKT DATETIME

INSERT INTO NHANVIEN (MANV, HOTENNV, NGAYVAOLAM, LUONGCB, MAQL)
	VALUES	('NV0001', 'Nguyen Van Hao', '1990-05-15', '30000000', NULL),
			('NV0002', 'Nguyen Thi Bich', '1985-12-28', '20000000', 'NV0001'),
			('NV0003', 'Le Van Cuong', '1988-09-03', '20000000', 'NV0001'),
			('NV0004', 'Dinh Cong Thanh', '1987-12-28', '20000000', 'NV0001');
INSERT INTO PHONGBAN
	VALUES	('PB1002', 'Phan Tich Du Lieu', 'NV0002'),
			('PB1003', 'Phan Tich Phan Mem', 'NV0003'),
			('PB1004', 'Tri Tue Nhan Tao', 'NV0004');
INSERT INTO DUAN
	VALUES	('DA3283', 'Xay dung he thong quan ly xe'),
			('DA2941', 'Xay dung he thong diem danh nhan vien'),
			('DA0375', 'Xay dung bao cao thong ke doanh thu');
INSERT INTO THAMGIADUAN
	VALUES	('DA3283', 'NV0001', 100000, 100, '2023-01-01', '2023-11-01'),
			('DA3283', 'NV0003', 120000, 50, '2023-05-29', NULL),
			('DA0375', 'NV0003', 95000, 25, '2023-07-20', NULL);

SELECT * FROM THAMGIADUAN

---CAU 3
UPDATE THAMGIADUAN
SET LUONGDA = LUONGDA*0.1 + LUONGDA
WHERE MADUAN = 'DA3283';

--CAU 4
ALTER TABLE THAMGIADUAN
ADD CHECK (TGKT > TGBD) 

--CAU 5
--CAU 6
SELECT D.MADUAN, TENDUAN, TGBD FROM DUAN D
JOIN THAMGIADUAN TG ON TG.MADUAN = D.MADUAN
WHERE GETDATE() BETWEEN TG.TGBD AND TG.TGKT
--CAU 7
SELECT MANV, HOTENNV, PB.TENPHPNGBAN, HOTENNV AS TENNGUOIQL FROM NHANVIEN NV
JOIN PHONGBAN PB ON PB.MAQL = NV.MANV
WHERE PB.MAPHONGBAN = 'PB1003'
--CAU 8
